<div class="row">
  <div class="col-sm-12">
    <app-card cardTitle="Rapport de Recettes de Caisse" [options]="false">
      <div class="card-body">
        <div *ngIf="errorMessage" class="alert alert-danger mb-3">
          {{ errorMessage }}
        </div>

        <form (ngSubmit)="loadRecettes()" #recettesForm="ngForm">
          <div class="row">
            <div class="form-group col-md-3">
              <label for="startDate">Date de Début</label>
              <input id="startDate" type="date" class="form-control" [(ngModel)]="startDate" name="startDate" required>
            </div>
            <div class="form-group col-md-3">
              <label for="endDate">Date de Fin</label>
              <input id="endDate" type="date" class="form-control" [(ngModel)]="endDate" name="endDate" required>
            </div>

            <div class="form-group col-md-3" *ngIf="currentUserRoles.has('ADMIN_GROUPE') || currentUserRoles.has('CSITE')">
              <label for="selectedUserId">Caissier</label>
              <select id="selectedUserId" class="form-control" [(ngModel)]="selectedUserId" name="selectedUserId">
                <option [value]="null">-- Tous les caissiers --</option>
                <option *ngFor="let cashier of cashiersList" [value]="cashier.id">
                  {{ cashier.nom }} {{ cashier.prenom }}
                </option>
              </select>
            </div>

            <div class="form-group col-md-3 d-flex align-items-end">
              <button type="submit" class="btn btn-primary" [disabled]="loading || recettesForm.invalid">
                <i class="feather icon-search"></i> Afficher
                <span *ngIf="loading" class="spinner-border spinner-border-sm ms-2" role="status"></span>
              </button>
            </div>
          </div>
        </form>

        <hr class="mt-4">

        <div class="d-flex justify-content-end mb-3" *ngIf="summaries.length > 0">
          <button type="button" class="btn btn-info me-2" (click)="exportReport('pdf')">
            <i class="feather icon-file-text"></i> Exporter PDF
          </button>
          <button type="button" class="btn btn-info" (click)="exportReport('csv')">
            <i class="feather icon-download"></i> Exporter CSV
          </button>
        </div>

        <div class="table-responsive" *ngIf="summaries.length > 0">
          <table class="table table-hover">
            <thead>
            <tr>
              <th>Date</th>
              <th>Caissier</th>
              <th>Solde Initial</th>
              <th>Dépôts</th>
              <th>Retraits</th>
              <th>Solde Final</th>
            </tr>
            </thead>
            <tbody>
              @for (summary of summaries; track summary.id) {
                <tr>
                  <td>{{ summary.operationDate | date:'shortDate' }}</td>
                  <td>{{ summary.caissierName || summary.caissierId }}</td>
                  <td>{{ summary.startingBalance }}</td>
                  <td>{{ summary.totalDeposits }}</td>
                  <td>{{ summary.totalWithdrawals}}</td>
                  <td>{{ summary.endingBalance }}</td>
                </tr>
              } @empty {
                <tr>
                  <td colspan="6" class="text-center">Aucun résumé de caisse trouvé pour la période.</td>
                </tr>
              }
            </tbody>
          </table>
        </div>

        <div *ngIf="!loading && summaries.length === 0 && !errorMessage" class="alert alert-info text-center mt-3">
          Aucun résumé de caisse trouvé pour la période sélectionnée.
        </div>
      </div>
    </app-card>
  </div>
</div>
